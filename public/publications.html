<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Publications | Miroir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PDF.js and Turn.js Libraries -->
  <script src="https://unpkg.com/pdfjs-dist/build/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turn.js@4/turn.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/turn.js@4/extras/basic.css">

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      color: #e50914;
      margin-bottom: 20px;
      font-size: 2rem;
    }

    .cover-image {
      max-width: 300px;
      width: 90%;
      margin: 20px auto;
      border: 3px solid #e50914;
      box-shadow: 0 0 15px #e50914;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .cover-image:hover {
      transform: scale(1.03);
    }

    #flipbook-container {
      display: none;
      margin: 30px auto;
      max-width: 90vw;
      height: auto;
    }

    #flipbook canvas {
      display: block;
      margin: 0 auto;
    }

    #loading {
      color: #999;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>The Triangle That Formed Me</h1>

  <!-- Thumbnail -->
  <img src="/trianglecover.jpg" alt="Triangle Cover" class="cover-image" id="openFlipbook">

  <!-- Flipbook Section -->
  <div id="flipbook-container">
    <div id="loading">Loading flipbook...</div>
    <div id="flipbook"></div>
  </div>

  <script>
    const pdfURL = '/triangle-formed-me.pdf';
    const openBtn = document.getElementById('openFlipbook');
    const flipbookContainer = document.getElementById('flipbook-container');
    const flipbook = document.getElementById('flipbook');
    const loading = document.getElementById('loading');

    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist/build/pdf.worker.min.js';

    openBtn.addEventListener('click', () => {
      openBtn.style.display = 'none';
      flipbookContainer.style.display = 'block';

      pdfjsLib.getDocument(pdfURL).promise.then(pdf => {
        const pageCount = pdf.numPages;
        const promises = [];

        for (let i = 1; i <= pageCount; i++) {
          promises.push(
            pdf.getPage(i).then(page => {
              const scale = 1.2;
              const viewport = page.getViewport({ scale });
              const canvas = document.createElement('canvas');
              const context = canvas.getContext('2d');
              canvas.width = viewport.width;
              canvas.height = viewport.height;

              return page.render({ canvasContext: context, viewport }).promise.then(() => {
                flipbook.appendChild(canvas);
              });
            })
          );
        }

        Promise.all(promises).then(() => {
          loading.style.display = 'none';
          $('#flipbook').turn({
            width: flipbook.scrollWidth,
            height: flipbook.scrollHeight,
            autoCenter: true
          });
        });

      }).catch(error => {
        loading.textContent = 'Failed to load PDF: ' + error.message;
      });
    });
  </script>
</body>
</html>
